<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"  errorPage="views/common/error.jsp"
    isELIgnored="false" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>testm</title>
<style type="text/css">
div.lineA { 
		height : 150px;
		border : 1px solid gray;
		float : left;   
		position : relative; 
		left : 120px;    
		margin:  5px;
		padding: 5px;		                                                                                                                                            
}
div#banner {
		width : 750px;
		padding : 0;
}
		

div#loginBox{
		width : 274px;
		font-size: 9px;
		text-align: left;
		padding-left: 20px
		
}

div#loginBox button {
		width : 250px;
		height : 35px;
		background-color : navy;
		color: white;
		margin-top: 10px;
		margin-bottom: 15px;
		font-size: 14px;
		font-weight: bold;
}
div#banner img {
		margin : 0;
		padding : 0;
		width : 750px;
		height : 110px;
		
}
</style>
<script type="text/javascript" src="/testm/resources/js/jquery-3.5.1.min.js""></script>
<script type="text/javascript">
$(function(){
	/* 주기적으로 반복요청하려면
	setInterval(function(){ $.ajax(); }, 시간);
	시간은 밀리세컨드임 : 1000 이 1초임 */
	/* setInterval(function(){
		console.log("setInterval() 에 의해 자동 실행 확인");
	}, 100); */
	
	//최근 등록한 공지글 3개 출력되게 함
	$.ajax({
		url: "/testm/ntop3", 
		type: "get",
		dataType: "json",
		success: function(data){//data가 매개변수임
			console.log("success :" +data);
			//object ==> string 으로 변환
			var jsonStr = JSON.stringify(data);
			//string ==> json 객체로 바꿈
			var json = JSON.parse(jsonStr);
			
			var values = "";		
			for(var i in json.list){
				values += "<tr><td>" + json.list[i].no 
							+ "</td><td><a href='/testm/ndetail?noticeno="
							+ json.list[i].no + "'>"
							+ decodeURIComponent(json.list[i].title).replace(/\+/gi, "  ")
							+ "</a></td><td>" + json.list[i].date +"</td></tr>";
			}//for in
			
			$("#newnotice").html($("#newnotice").html() + values );
		}, 
		error: function(jqXHR, textstatus, errorthrown){
			console.log("error: "+ jqXHR + ","+ textstatus+","+errorthrown);
		}
		
	});
	//조회수 많은 인기 게시 원글 상위 3개 조회 출력 처리
	$.ajax({
		url: "/testm/btop3",
		type: "get",
		dataType: "json",
		success: function(data){//data가 매개변수임
			console.log("success :" +data);
			//object ==> string 으로 변환
			var jsonStr = JSON.stringify(data);
			//string ==> json 객체로 바꿈
			var json = JSON.parse(jsonStr);
			
			var values = "";		
			for(var i in json.list){
				values += "<tr><td>" + json.list[i].bnum 
							+ "</td><td><a href='/testm/bdetail?bnum="
							+ json.list[i].bnum  + "'>"
							+ decodeURIComponent(json.list[i].btitle).replace(/\+/gi, "  ")
							+ "</a></td><td>" + json.list[i].rcount +"</td></tr>";
			}//for in
			
			$("#toplist").html($("#toplist").html() + values );
		}, //$("#toplist") 에서 toplist은 테이블?? 검색해보자 나중에
		error:  function(jqXHR, textstatus, errorthrown){
			console.log("error: "+ jqXHR + ","+ textstatus+","+errorthrown);
		}//위에꺼 복붙했음.
	});
	
});//document.ready
function movePage(){    //자바함수넣어주는 방법이고 ㄴ매개변수가 없어서 ()이렇게 하는것
		location.href = "views/member/loginPage.html";
}
</script>
</head>
<body>
<c:import url="views/common/header.jsp"/>
<hr style="clear:both;">
<center>
<div id="banner" class="lineA">
<img src="resources/images/강쥐.jpg">
</div>
<c:if test="${ empty loginMember }"> <!— 로그인 안 한 상태이면  —>
<div id="loginBox" class="lineA">
test사이트 환영합니다<br>
<!—  <button onclick="javascript:location.href='views/member/loginPage.html';">로그인 하세요.</button> <br> —>
<button onclick="movePage();">로그인 하세요</button><br> <!—자바함수넣어주는 것, 일반적인 방법 , 대소문자구분함 —>
<a>아이디/비밀번호 조회</a> 
 &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;
<a href="views/member/enrollPage.html">회원가입</a> <!—지정된위치를 작성해야함 안그러면 오류 —>
</div>
</c:if>
<c:if test="${ !empty sessionScope.loginMember  and loginMember.userid ne 'admin'  }" >
<%— <% } else { //일반 회원이 로그인한 상태이면 %> —%>
<div id="loginBox" class="lineA">
${  sessionScope.loginMember.username } 님<br>
<button onclick="javascript:location.href='logout';">로그아웃</button><br> <!—자바함수넣어주는 것, 일반적인 방법 , 대소문자구분함 —>
<a>쪽지</a>  &nbsp; &nbsp; 
<a>메일</a>
 &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;
 <c:url var="callMyinfo" value="myinfo">
      <c:param name="userid" value="${ sessionScope.loginMember.userid }"/>
</c:url>
 <a href="${ callMyinfo }">My Page</a>
<!— 쿼리스트링(Query String ) : ?이름=전송값&이름=전송값   (단, 공백없이 써야한다)—>
</div>
</c:if>
<c:if test="${ !empty loginMember and loginMember.userid eq 'admin'  }"> <!— 관리자가 로그인한 상태이면  —>
<%— <% } else if(loginMember.getUserid().equals("admin")){ //%> —%>
<div id="loginBox" class="lineA">
${  sessionScope.loginMember.username }님<br>
<button onclick="javascript:location.href='logout';">로그아웃</button> <br>
<a href="/testm/mlist">회원관리</a>  &nbsp; &nbsp;
<a>공지사항 관리</a>   &nbsp; &nbsp;
<a>게시글 관리</a>   &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
 <a href="${ callMyinfo }">마이 페이지</a>
<!— 쿼리스트링(Query String) : ?이름=전송값&이름=전송값 —>
</div>
</c:if>

<hr style="clear:left;">
<footer></footer>
</center>
<section>
<!— 최근 등록 공지글 3개 조회 출력 —>
<div style="float:left;border:1px solid navy;padding:5px;margin:5px">
<h4>최근 공지글</h4>
<table id="newnotice" border="1" cellspacing="0" >
<tr><th>번호</th><th>제목</th><th>날짜</th></tr>
</table>
</div>
<!— 조회수 많은 게시글 3개 조회 출력 —>
<div style="float:left;border:1px solid navy;padding:5px;margin:5px">
<h4>인기 게시글</h4>
<table id="toplist" border="1" cellspacing="0" >
<tr><th>번호</th><th>제목</th><th>조회수</th></tr>
</table>
</div>
</section>
<hr style="clear:both;">
<!— 상대경로만 사용 가능함 —>
<c:import url="views/common/footer.jsp" />
</body>
</html>